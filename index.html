<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水資源永續挑戰</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 基本設定 */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Noto Sans TC', sans-serif;
            overflow: hidden;
            background-color: #0b132b;
        }

        /* --- 背景層 --- */
        .background-gradient {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(-45deg, #0b132b, #1c2541, #3a506b, #5bc0be);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: 1;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        #particle-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2;
        }

        /* --- 內容層 --- */
        .screen {
            width: 100%; height: 100%; display: flex;
            justify-content: center; align-items: center; text-align: center; color: #ffffff;
            position: absolute; top: 0; left: 0;
            opacity: 0; visibility: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            z-index: 3;
        }
        .screen.active { opacity: 1; visibility: visible; }
        #home-screen { flex-direction: column; }
        .logo {
            width: 180px; height: 180px; margin-bottom: 2rem;
            animation: float 4s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(91, 192, 190, 0.5));
            border-radius: 50%; object-fit: cover;
        }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }
        
        h1 { font-size: 2.8rem; text-shadow: 0 0 10px rgba(0, 0, 0, 0.5); margin-bottom: 1rem; font-weight: 700; }
        p.subtitle { font-size: 1.2rem; color: #cdd4e4; margin-bottom: 2.5rem; }

        .start-button {
            background-color: #5bc0be; color: #0b132b; border: none; padding: 15px 40px;
            font-size: 1.2rem; font-weight: 700; border-radius: 50px; cursor: pointer;
            transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(91, 192, 190, 0.3); letter-spacing: 1px;
        }
        .start-button:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 8px 25px rgba(91, 192, 190, 0.5); }
        
        /* 修改：教學引導的背景畫面 */
        #tutorial-screen {
            background-color: #f0f2f5;
        }
        #tutorial-bg-img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 確保UI完整顯示 */
            transition: opacity 0.3s ease; /* 新增淡入淡出效果 */
        }
        
        .next-page-button {
            position: fixed; bottom: 30px; right: 30px; background-color: #e67e22; color: white;
            padding: 12px 25px; border-radius: 50px; text-decoration: none; font-size: 1.1rem;
            font-weight: 500; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); transition: all 0.3s ease;
            z-index: 1000; /* 確保按鈕在教學背景之上 */
        }
        .next-page-button:hover { background-color: #d35400; transform: scale(1.05); }

        /* --- 教學引導層樣式 --- */
        #tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1500;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        #tutorial-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        #tutorial-highlight {
            position: absolute;
            border: 3px solid #e74c3c; /* 改為紅色以匹配您的範例 */
            border-radius: 8px; /* 預設方角 */
            box-shadow: 0 0 0 9999px rgba(11, 19, 43, 0.85);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #tutorial-text {
            position: absolute;
            background-color: rgba(44, 62, 80, 0.95);
            color: #ecf0f1;
            padding: 20px 25px;
            border-radius: 10px;
            border: 1px solid #7f8c8d;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1.7;
            font-size: 1.1rem;
        }
        #tutorial-text h3 {
            margin: 0 0 10px 0;
            color: #5bc0be;
            font-size: 1.4rem;
        }
        #tutorial-text p {
            margin: 0 0 15px 0;
        }
        #tutorial-text small {
            color: #bdc3c7;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            p.subtitle { font-size: 1rem; }
            .logo { width: 140px; height: 140px; }
            .start-button { padding: 12px 30px; font-size: 1rem;}
            .next-page-button { bottom: 20px; right: 20px; padding: 10px 20px; font-size: 1rem;}
            #tutorial-text { font-size: 1rem; padding: 15px 20px;}
            #tutorial-text h3 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <!-- 背景層 -->
    <div class="background-gradient"></div>
    <canvas id="particle-canvas"></canvas>

    <!-- 內容層 -->
    <div id="home-screen" class="screen active">
        <img src="dry-logo.png" alt="水資源 Logo" class="logo">
        <h1>水資源永續挑戰</h1>
        <p class="subtitle">了解水情，學習節水，應對未來的乾旱風險</p>
        <button id="start-btn" class="start-button">開始挑戰</button>
    </div>

    <!-- 教學引導畫面 -->
    <div id="tutorial-screen" class="screen">
        <img id="tutorial-bg-img" src="" alt="防災資訊網教學背景">
        <a href="drought_simulator.html" class="next-page-button">下一頁 &raquo;</a>
    </div>

    <!-- 教學引導層 -->
    <div id="tutorial-overlay">
        <div id="tutorial-highlight"></div>
        <div id="tutorial-text"></div>
    </div>

    <script>
        // --- 粒子動畫邏輯 (保持不變) ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let particlesArray;
        class Particle{constructor(t,e,i,o,s,a){this.x=t,this.y=e,this.directionX=i,this.directionY=o,this.size=s,this.color=a}draw(){ctx.beginPath(),ctx.arc(this.x,this.y,this.size,0,2*Math.PI,!1),ctx.fillStyle=this.color,ctx.fill()}update(){this.x>canvas.width||this.x<0?this.directionX=-this.directionX:void 0,this.y>canvas.height||this.y<0?this.directionY=-this.directionY:void 0,this.x+=this.directionX,this.y+=this.directionY,this.draw()}}
        function init(){particlesArray=[];const t=(canvas.height*canvas.width)/9e3;for(let e=0;e<t;e++){const t=2*Math.random()+1,i=Math.random()*(innerWidth-2*t-2*t)+2*t,o=Math.random()*(innerHeight-2*t-2*t)+2*t,s=.4*Math.random()-.2,a=.4*Math.random()-.2;particlesArray.push(new Particle(i,o,s,a,t,"rgba(200, 210, 255, 0.8)"))}}
        function connect(){let t=1;for(let e=0;e<particlesArray.length;e++)for(let i=e;i<particlesArray.length;i++){const o=(particlesArray[e].x-particlesArray[i].x)*(particlesArray[e].x-particlesArray[i].x)+(particlesArray[e].y-particlesArray[i].y)*(particlesArray[e].y-particlesArray[i].y);o<canvas.width/7*(canvas.height/7)&&(t=1-o/2e4,ctx.strokeStyle=`rgba(180, 190, 255, ${t})`,ctx.lineWidth=1,ctx.beginPath(),ctx.moveTo(particlesArray[e].x,particlesArray[e].y),ctx.lineTo(particlesArray[i].x,particlesArray[i].y),ctx.stroke())}}
        function animate(){requestAnimationFrame(animate),ctx.clearRect(0,0,innerWidth,innerHeight);for(let t=0;t<particlesArray.length;t++)particlesArray[t].update();connect()}
        window.addEventListener("resize",()=>{canvas.width=innerWidth,canvas.height=innerHeight,init()}),init(),animate();


        // --- 頁面切換與教學引導邏輯 ---
        const startBtn = document.getElementById('start-btn');
        const homeScreen = document.getElementById('home-screen');
        const tutorialScreen = document.getElementById('tutorial-screen');
        const tutorialBgImg = document.getElementById('tutorial-bg-img'); // 新增對背景圖的引用
        const tutorialOverlay = document.getElementById('tutorial-overlay');
        const tutorialHighlight = document.getElementById('tutorial-highlight');
        const tutorialText = document.getElementById('tutorial-text');

        // *** 核心修改：教學步驟陣列，新增 background 屬性並更新座標 ***
        // 請確認您的圖片檔名與此處設定相符
        const tutorialSteps = [
            {
                background: 'page1.jpg',
                highlight: { top: '25.0%', left: '15.9%', width: '7.6%', height: '6.2%', borderRadius: '8px' },
                text: { top: '35%', left: '18%', maxWidth: '350px', maxHeight: 'auto' },
                content: `<h3>步驟 1：選擇縣市</h3><p>首先，從這裡的下拉選單中，選擇您想查詢水情的縣市。</p>`
            },
            {
                background: 'page2.jpg',
                highlight: { top: '8.7%', left: '59.2%', width: '10.3%', height: '34.1%', borderRadius: '8px' },
                text: { top: '26.2%', left: '28.1%', maxWidth: '300px', maxHeight: 'auto' },
                content: `<h3>步驟 2：防災快訊</h3><p>這裡是「防災快訊」區，點擊可查看重要的警示資訊，如水庫放水、高溫警報或停水通知。</p>`
            },
            {
                background: 'page3.jpg',
                highlight: { top: '9.1%', left: '65.3%', width: '10.3%', height: '47.1%', borderRadius: '8px' },
                text: { top: '26.2%', left: '34.1%', maxWidth: '300px', maxHeight: 'auto' },
                content: `<h3>步驟 3：警戒資訊</h3><p>在「警戒資訊」中，您可以查詢全台灣各地的淹水、河川水位及水庫狀態的警戒等級。</p>`
            },
            {
                background: 'page4.jpg',
                highlight: { top: '9.4%', left: '71.7%', width: '9.5%', height: '42.8%', borderRadius: '8px' },
                text: { top: '26.2%', left: '38%', maxWidth: '330px', maxHeight: 'auto' },
                content: `<h3>步驟 4：監控資訊</h3><p>「監控資訊」是關鍵！這裡提供詳細的水庫水情視覺化圖表、即時資訊與歷史數據比對分析。</p>`
            },
            {
                background: 'page5.jpg',
                highlight: { top: 'calc(100% - 78px)', left: 'calc(100% - 175px)', width: '145px', height: '48px', borderRadius: '50px' },
                text: { top: '60%', left: '53%', maxWidth: '350px', maxHeight: 'auto' },
                content: `<h3>步驟 5：開始模擬</h3><p>恭喜您！完成資訊導覽後，請點擊右下角的「下一頁」按鈕，進入乾旱風險情境模擬挑戰！</p>`
            }
        ];

        let currentStep = -1;

        // *** 核心修改：showStep 函數現在會更換背景圖片 ***
        function showStep(stepIndex) {
            if (stepIndex >= tutorialSteps.length) {
                endTutorial();
                return;
            }

            const step = tutorialSteps[stepIndex];
            
            // 更換背景圖 (帶有淡入淡出效果)
            tutorialBgImg.style.opacity = 0; // 先淡出
            setTimeout(() => {
                tutorialBgImg.src = step.background;
                tutorialBgImg.style.opacity = 1; // 再淡入
            }, 300); // 等待淡出動畫完成

            // 更新標示框位置與樣式
            tutorialHighlight.style.top = step.highlight.top;
            tutorialHighlight.style.left = step.highlight.left;
            tutorialHighlight.style.width = step.highlight.width;
            tutorialHighlight.style.height = step.highlight.height;
            tutorialHighlight.style.borderRadius = step.highlight.borderRadius;
            
            // 更新文字框位置與內容
            tutorialText.style.top = step.text.top;
            tutorialText.style.left = step.text.left;
            tutorialText.style.maxWidth = step.text.maxWidth || 'auto';
            tutorialText.style.maxHeight = step.text.maxHeight || 'auto';
            let smallText = stepIndex < tutorialSteps.length - 1 ? '<small>點擊畫面任意處繼續...</small>' : '<small>教學結束！請點擊右下角按鈕開始模擬。</small>';
            tutorialText.innerHTML = `${step.content}${smallText}`;
        }
        
        function startTutorial() {
            homeScreen.classList.remove('active');
            tutorialScreen.classList.add('active');
            
            setTimeout(() => {
                tutorialOverlay.classList.add('active');
                currentStep = 0;
                showStep(currentStep);
            }, 500); // 等待畫面切換動畫完成
        }

        function endTutorial() {
            tutorialOverlay.classList.remove('active');
        }

        startBtn.addEventListener('click', startTutorial);

        // --- 座標獲取輔助工具 --- 
        tutorialOverlay.addEventListener('mousedown', function(e) {
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const xPercent = (x / window.innerWidth * 100).toFixed(1);
            const yPercent = (y / window.innerHeight * 100).toFixed(1);

            console.log(`點擊座標: { top: '${yPercent}%', left: '${xPercent}%' }`);
        });
        // --- 輔助工具結束 ---

        tutorialOverlay.addEventListener('click', () => {
            currentStep++;
            showStep(currentStep);
        });
    </script>

</body>
</html>